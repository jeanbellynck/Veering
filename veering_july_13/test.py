from train_track import *

def boundary_tighten(w):
    # returns (y,x) where w = xyx^-1 and y is cyclically reduced
    w = w[:]
    if len(w) <= 1:
        return (w, [])
    x = []
    while len(w) > 1 and w[0] == -w[-1]:
        x.append(w[0])
        del w[0]
        del w[-1]
    return (w, x)

def solvePowers(w1, w2, RHS):
    # Solves w1^m w2^n (reduced) = RHS returning (m,n) or None if no solution.
    if not RHS:
        return (0, 0)
    t_p1, x = boundary_tighten(w1)
    t_p2, y = boundary_tighten(w2)

    def wpow(w, x, n):
        if n == 0:
            return []
        if n < 0:
            return x + reverse(w)*(-n) + reverse(x)
        if n > 0:
            return x + w*n + reverse(x)
               
    m = 0
    while True:
        n = 0
        while True:
            print 'm,n',m,n
            all_greater = True
            for sgn1 in [-1,1]:
                for sgn2 in [-1,1]:
                    z1 = wpow(t_p1, x, sgn1*m)
                    z2 = wpow(t_p2, y, sgn2*n)
                    LHS = TrainTrack.pulltight(z1+z2)
                    #print 'z1',z1,'z2',z2,'LHS', LHS, 'n=',n
                    if LHS == RHS:
                        return (sgn1*m,sgn2*n)
                    if len(LHS) <= len(RHS) and len(LHS) > 0:
                        all_greater = False
            if all_greater and n > 0:
                break
            else:
                n += 1
        if len(TrainTrack.pulltight(w1*m)) - len(w1) > len(RHS):
            break
        else:
            m += 1
    return None
                        
print solvePowers([1,2], [-4,-3], [1,2])
w1 = [1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, -20, 10, 14, 23, 13, -27, -25, -22, -12, -24, 5, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 9, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, -20, 10, 14, 23, 13, -27, -25, -22, -12, -24, 5, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, -20, 10, 14, 23, 13, -27, -25, -22, -12, -24, 5, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, -20, 10, 14, 23, 13, -27, -25, -22, -12, -24, 5, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 9, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, -20, 10, 14, 23, 13, -27, -25, -22, -12, -24, 5, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, -20, 10, 14, 23, 13, -27, -25, -22, -12, -24, 5, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, -20, 10, 14, 23, 13, -27, -25, -22, -12, -24, 5, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 7, -11, -21, 12, 22, 25, 27, 30, -29, -28, 10, 14, 6, 8, 9, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, -20, 10, 14, 23, 13, -27, -25, -22, -12, -24, 5, 26, 1, 2, 4, 11, 19, -30, -27, -25, -22, -12, -24, 5, 26, 1, 2, -18, 14, 6, -20, 10, 14, 23, 13, -27, -25, -22, -12, -24, 5, 26]
w2 = [-26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -9, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -3, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -21, 12, 17, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -9, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1]
RHS = [-26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -9, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -3, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -21, 12, 17, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -9, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, -10, 28, 29, -30, -27, -25, -22, -12, 21, 11, -7, -8, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1, -26, -5, 24, 12, 22, 25, 27, -13, -23, -14, -10, 20, -6, -14, 18, -2, -1, -26, -5, 24, 12, 22, 25, 27, 30, -19, -11, -4, -2, -1]
print solvePowers(w1,w2,RHS)
